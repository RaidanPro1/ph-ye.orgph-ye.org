@if (userService.isAuthenticated()) {
  <app-dashboard-layout 
    [user]="userService.currentUser()" 
    [currentPage]="currentPage()" 
    (navigate)="handleNavigation($event)" 
    (logout)="handleLogout()">
  </app-dashboard-layout>
} @else {
  <div class="min-h-screen flex flex-col">
    <app-header 
      [isAuthenticated]="false" 
      (login)="handleLogin()"
      (navigate)="handleNavigation($event)"></app-header>
    <main class="flex-grow">
      @switch (currentPage()) {
        @case ('home') { <app-home (login)="handleLogin()" (navigate)="handleNavigation($event)"></app-home> }
        @case ('about') { <app-about-us></app-about-us> }
        @case ('platform-overview') { <app-platform-overview (login)="handleLogin()"></app-platform-overview> }
        @case ('privacy-policy') { <app-privacy-policy (navigate)="handleNavigation($event)"></app-privacy-policy> }
        @case ('terms-of-service') { <app-terms-of-service (navigate)="handleNavigation($event)"></app-terms-of-service> }
        @case ('cookie-policy') { <app-cookie-policy></app-cookie-policy> }
        @case ('disclaimer') { <app-disclaimer></app-disclaimer> }
        @case ('register') { <app-register (register)="handleRegister()" (navigate)="handleNavigation($event)"></app-register> }
        @case ('violations-observatory-public') { <app-violations-observatory-public (login)="handleLogin()"></app-violations-observatory-public> }
        @case ('training-portal-public') { <app-training-portal-public (login)="handleLogin()"></app-training-portal-public> }
        @case ('tech-support-public') { <app-tech-support-public (login)="handleLogin()"></app-tech-support-public> }
        @case ('news-public') { <app-news-public (login)="handleLogin()"></app-news-public> }
        @case ('projects-public') { <app-projects-public (login)="handleLogin()"></app-projects-public> }
        @default { <app-home (login)="handleLogin()" (navigate)="handleNavigation($event)"></app-home> }
      }
    </main>
    <app-footer (navigate)="handleNavigation($event)"></app-footer>
  </div>
}

@if (trialService.showLoginModal()) {
  <app-login-modal (login)="handleLogin()" (close)="trialService.closeModal()" (navigate)="handleNavigation($event)"></app-login-modal>
}

@if (showOnboarding()) {
  <app-onboarding (finish)="handleFinishOnboarding()"></app-onboarding>
}

<!-- Gemini Code Assist FAB and Modal -->
@if (isSuperAdmin()) {
  <button 
    (click)="toggleGeminiAssist()"
    title="Gemini Code Assist"
    class="fixed bottom-8 left-8 z-40 w-16 h-16 bg-purple-600 text-white rounded-full shadow-lg hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-300 flex items-center justify-center transition-transform hover:scale-110">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
      <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25" />
    </svg>
  </button>

  @if (showGeminiAssist()) {
    <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-fade-in" (click)="toggleGeminiAssist()">
      <div class="bg-base-100 rounded-2xl shadow-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
          <div class="p-6 relative">
              <button (click)="toggleGeminiAssist()" title="إغلاق" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
              </button>
              <app-gemini-code-assist></app-gemini-code-assist>
          </div>
      </div>
    </div>
  }
}

<app-confirmation-modal></app-confirmation-modal>